<form *ngIf="showForm" class="custom-form" [formGroup]="individualForm">
  <ng-container *ngFor="let section of formSections">
    <p-panel
      [header]="section.formName"
      [toggleable]="true"
      [formGroup]="individualForm.controls[section.formName]"
      *ngIf="section.isVisible"
    >
      <div class="row">
        <ng-container *ngFor="let field of section.fields">
          <div
            *ngIf="field.visible"
            [ngClass]="{
              'col-xs-12 col-sm-6 col-md-4 col-lg-2 p-2 fieldForm':
                !field?.newLineField,
              checkbox: field.fieldType == 'checkbox',
              newLineField: field?.newLineField
            }"
          >
            <label
              [attr.title]="
                field.fieldLabel.length > 27 ? field.fieldLabel : ''
              "
              >{{
                field.fieldLabel.length > 27 && !field?.newLineField
                  ? field.fieldLabel.substring(0, 27) + ".."
                  : field.fieldLabel
              }}</label
            ><span *ngIf="field.required" class="required">*</span>
            <ng-container [ngSwitch]="field.fieldType">
              <ng-container *ngSwitchCase="'text'">
                <div
                  style="position: 'relative'"
                  [pTooltip]="
                    individualForm.controls[field.formName]['controls'][
                      field.name
                    ].errors?.invalidValue
                      ? field.displayValidValuesOnHover == 'Yes'
                        ? 'Valid values are ' + field.validValues.join(', ')
                        : ''
                      : ''
                  "
                  tooltipPosition="top"
                >
                  <input
                    type="text"
                    class="block"
                    pInputText
                    [formControlName]="field.name"
                    [ngStyle]="{
                      paddingLeft: field.prefix ? '45px' : '',
                      paddingRight: field.suffix ? '40px' : ''
                    }"
                    (ngModelChange)="checkValidValuesText($event, field)"
                  />
                  <span class="prefix-Inp" *ngIf="field.prefix">{{
                    field.prefix
                  }}</span>
                  <span class="suffix-Inp" *ngIf="field.suffix">{{
                    field.suffix
                  }}</span>
                </div>
              </ng-container>
              <ng-container *ngSwitchCase="'number'">
                <ng-container>
                  <div
                    style="position: 'relative'"
                    [pTooltip]="
                      individualForm.controls[field.formName]['controls'][
                        field.name
                      ].errors?.invalidValue
                        ? field.displayValidValuesOnHover == 'Yes'
                          ? 'Valid values are ' + field.validValues.join(', ')
                          : ''
                        : ''
                    "
                    tooltipPosition="top"
                  >
                    <input
                      type="text"
                      class="block"
                      pInputText
                      [formControlName]="field.name"
                      [ngStyle]="{
                        paddingLeft: field.prefix ? '45px' : '',
                        paddingRight: field.suffix ? '40px' : ''
                      }"
                      (ngModelChange)="checkValidValuesText($event, field)"
                    />
                    <span class="prefix-Inp" *ngIf="field.prefix">{{
                      field.prefix
                    }}</span>
                    <span class="suffix-Inp" *ngIf="field.suffix">{{
                      field.suffix
                    }}</span>
                  </div>
                </ng-container>
                <!-- <ng-container
                  *ngIf="
                    !(
                      field.name == 'contactMobileNumber' ||
                      field.name == 'contactPhoneNumber'
                    )
                  "
                >
                  <input
                    type="text"
                    class="block"
                    pInputText
                    pattern="[0-9\s]{0,20}"
                    [formControlName]="field.name"
                  />
                </ng-container> -->
              </ng-container>
              <!-- <div class="currency-Inp" *ngSwitchCase="'currency'">
                <input type="text" pInputText [formControlName]="field.name" />
                <span>AED</span>
              </div> -->
              <p-calendar
                *ngSwitchCase="'date'"
                class="block"
                placeholder="DD/MM/YYYY"
                dateFormat="dd/mm/yy"
                [showIcon]="true"
                [formControlName]="field.name"
                [minDate]="field.minDate"
                [maxDate]="field.maxDate"
                [defaultDate]="field.defaultDate"
                [readonlyInput]="false"
                [appendTo]="'body'"
                (onSelect)="handleDateSelect(calendar, $event)"
                (ngModelChange)="checkValidValuesDate($event, field)"
                appDateMask
                [pTooltip]="
                  individualForm.controls[field.formName]['controls'][
                    field.name
                  ].errors?.invalidValue
                    ? field.displayValidValuesOnHover == 'Yes'
                      ? 'Valid values are ' + field.validValues.join(', ')
                      : ''
                    : ''
                "
                tooltipPosition="top"
                #calendar
              ></p-calendar>
              <p-checkbox
                *ngSwitchCase="'checkbox'"
                [formControlName]="field.name"
                [binary]="true"
                (onChange)="sameAddress($event, field.name)"
              ></p-checkbox>
              <p-dropdown
                *ngSwitchCase="'dropdownSingle'"
                class="block"
                [options]="
                  field.setOptions && field.setOptions.length
                    ? field.setOptions
                    : masterData[field.apiKey]
                "
                [formControlName]="field.name"
                placeholder="Type to search"
                optionLabel="codeName"
                [appendTo]="'body'"
                [filter]="true"
                filterBy="codeName"
                [virtualScroll]="true"
                [virtualScrollItemSize]="35"
                panelStyleClass="formFields-dropdown"
              >
                <ng-template let-options pTemplate="item">
                  <div class="truncate-text">
                    <div>{{ options.codeName }}</div>
                  </div>
                </ng-template></p-dropdown
              >
              <p-dropdown
                *ngSwitchCase="'smart-search'"
                class="block smartSearch"
                [formControlName]="field.name"
                [options]="
                  field.setOptions && field.setOptions.length
                    ? field.setOptions
                    : masterData[field.apiKey]
                "
                optionLabel="codeName"
                [filter]="true"
                filterBy="codeName"
                placeholder="Type to search"
              >
                <ng-template pTemplate="selectedItem">
                  <div class="country-item country-item-value" *ngIf="field">
                    <div>
                      {{
                        individualForm.controls[section.formName]["controls"][
                          field.name
                        ].value.codeName
                      }}
                    </div>
                  </div>
                </ng-template>
                <ng-template let-options pTemplate="item">
                  <div class="truncate-text">
                    <div>{{ options.codeName }}</div>
                  </div>
                </ng-template>
              </p-dropdown>
              <select
                *ngSwitchCase="'multiselect'"
                multiple
                [formControlName]="field.name"
              >
                <option
                  *ngFor="let option of field.options"
                  [value]="option.value"
                >
                  {{ option.label }}
                </option>
              </select>
            </ng-container>
            <small
              *ngIf="
                submitted &&
                individualForm.controls[section.formName]['controls'][
                  field.name
                ].errors?.required
              "
              class="p-error block"
              >{{ field.fieldLabel }} is required.</small
            >
            <small
              *ngIf="
                !individualForm.controls[section.formName]['controls'][
                  field.name
                ].pristine &&
                individualForm.controls[section.formName]['controls'][
                  field.name
                ].errors?.minlength
              "
              class="p-error block"
              >{{ field.fieldLabel }} must be {{ field.minLength }} characters
              long.</small
            >
            <small
              *ngIf="
                !individualForm.controls[section.formName]['controls'][
                  field.name
                ].pristine &&
                individualForm.controls[section.formName]['controls'][
                  field.name
                ].errors?.pattern
              "
              class="p-error block"
              >{{
                field.regexMsg
                  ? field.regexMsg
                  : "Improper " + field.fieldLabel + " format."
              }}</small
            >
            <small
              *ngIf="
                !individualForm.controls[section.formName]['controls'][
                  field.name
                ].pristine &&
                individualForm.controls[section.formName]['controls'][
                  field.name
                ].errors?.maxlength
              "
              class="p-error block"
              >{{ field.fieldLabel }} must not exceed
              {{ field.maxLength }} characters.</small
            >
            <small
              *ngIf="
                individualForm.controls[section.formName]['controls'][
                  field.name
                ].errors?.invalidValue
              "
              class="p-error block"
              >Please enter a valid value.</small
            >
          </div>
        </ng-container>
      </div>
    </p-panel>
    <p-panel
      *ngIf="!section.isVisible"
      [header]="section.formName"
      class="no-visible"
    >
      No Visible fields available.
    </p-panel>
  </ng-container>
  <div class="form-group btn-grp buttons-section">
    <button
      pButton
      pRipple
      type="button"
      label="Save"
      class="p-button-raised"
      (click)="onSubmit()"
      [disabled]="deactivated"
    ></button>
    <button
      pButton
      pRipple
      type="button"
      label="Reset"
      class="p-button-warning"
      (click)="onReset()"
      [disabled]="deactivated"
    ></button>
    <button
      *ngIf="modeVal == 'edit'"
      pButton
      pRipple
      type="button"
      label="{{ deactivated ? 'Activate' : 'Deactivate' }}"
      class="p-button-raised"
      (click)="onActive(data)"
    ></button>
  </div>
</form>
<div class="NorecordFound" *ngIf="!showForm">
  <div class="row">
    <div class="col-12"><img src="assets/noRecordFound.svg" /></div>
  </div>
  <div class="row">
    <div class="col-12">
      <p>No Data Found.</p>
    </div>
  </div>
</div>
<p-confirmDialog
  key="resetBenfWarning"
  class="confirm-popup"
  #cd
  [closable]="false"
>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      label="Yes"
      (click)="cd.accept()"
    ></button>

    <button
      type="button"
      pButton
      icon="pi pi-times"
      label="No"
      (click)="cd.reject()"
    ></button>
  </p-footer>
</p-confirmDialog>

<p-confirmDialog
  key="activeDeactiveStatusBenef"
  class="status-confirm confirm-popup"
  #cd4
  [closable]="false"
>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      label="Yes"
      (click)="cd4.accept()"
    ></button>

    <button
      type="button"
      pButton
      icon="pi pi-times"
      label="No"
      (click)="cd4.reject()"
    ></button>
  </p-footer>
</p-confirmDialog>
