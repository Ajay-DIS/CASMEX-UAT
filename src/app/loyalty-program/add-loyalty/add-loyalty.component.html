<div class="visible-main-section">
  <div class="details-page-card">
    <div class="d-flex mx-3" style="justify-content: space-between">
      <div class="col-12">
        <div class="row">
          <div class="col-md-7 col-lg-7 col-sm-12 col-xs-12">
            <p class="description-text">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="41"
                height="35"
                viewBox="0 0 41 41"
              >
                <g
                  id="Group_2248"
                  data-name="Group 2248"
                  transform="translate(-341 -138)"
                >
                  <circle
                    id="Ellipse_130"
                    data-name="Ellipse 130"
                    cx="20.5"
                    cy="20.5"
                    r="20.5"
                    transform="translate(341 138)"
                    [attr.fill]="primaryColor"
                  />
                  <path
                    id="_52_Note_Basic_Description"
                    data-name="52  Note, Basic, Description"
                    d="M17.054,9.537H9.52a.753.753,0,0,1-.753-.753V5.016a.753.753,0,0,1,.753-.753h.851a3.014,3.014,0,0,1,5.831,0h.851a.753.753,0,0,1,.753.753V8.783A.753.753,0,0,1,17.054,9.537ZM10.274,8.03H16.3V5.77h-.753a.753.753,0,0,1-.753-.753,1.507,1.507,0,0,0-3.014,0,.753.753,0,0,1-.753.753h-.753Zm11.3,12.808V7.277a2.26,2.26,0,0,0-2.26-2.26h-.753V6.523h.753a.753.753,0,0,1,.753.753V20.837a.753.753,0,0,1-.753.753H7.26a.753.753,0,0,1-.753-.753V7.277a.753.753,0,0,1,.753-.753h.753V5.016H7.26A2.26,2.26,0,0,0,5,7.277V20.837A2.26,2.26,0,0,0,7.26,23.1H19.314A2.26,2.26,0,0,0,21.574,20.837ZM17.808,11.8H8.767V13.3h9.041Zm0,3.014H8.767v1.507h9.041Zm0,3.014H8.767v1.507h9.041Z"
                    transform="translate(348.213 145.945)"
                    fill="#fff"
                  />
                </g>
              </svg>
              Enables users to configure loyalty program related settings.
            </p>
          </div>
          <div class="col-md-5 col-lg-5 col-sm-12 col-xs-12">
            <div class="row">
              <div class="buttons-section">
                <button
                  pButton
                  pRipple
                  type="button"
                  [disabled]="
                    !applyCriteriaFormattedData?.length || deactivated
                  "
                  label="Save"
                  class="p-button-raised"
                  (click)="saveAddNewLoyalty()"
                ></button>
                <button
                  pButton
                  pRipple
                  type="button"
                  label="Reset"
                  class="p-button-warning"
                  (click)="reset()"
                  [disabled]="deactivated"
                ></button>
                <button
                  *ngIf="mode == 'edit'"
                  pButton
                  pRipple
                  type="button"
                  label="{{ deactivated ? 'Activate' : 'Deactivate' }}"
                  class="p-button-raised"
                  (click)="onActive()"
                ></button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <div [formGroup]="selectAppModule" class="select-module-application m-2">
      <div class="col-12">
        <div class="row">
          <div class="d-flex field col-md-4 col-lg-4 col-sm-12 col-xs-12 md-4">
            <label
              class="detail-page-section-heading col-sm-3 col-xs-12"
              for="application"
              >Application</label
            >
            <p-dropdown
              name="application"
              inputId="application"
              [options]="searchApplicationOptions"
              placeholder="Select"
              optionLabel="name"
              formControlName="applications"
              (onChange)="onAppValueChange()"
            ></p-dropdown>
          </div>
          <div class="d-flex field col-md-4 col-lg-4 col-sm-12 col-xs-12 md-4">
            <label
              class="detail-page-section-heading col-sm-3 col-xs-12 small"
              for="module"
              >Module</label
            >
            <p-dropdown
              name="module"
              inputId="module"
              [options]="searchModuleOptions"
              placeholder="Select"
              optionLabel="name"
              formControlName="modules"
              (onChange)="searchAppModule()"
            ></p-dropdown>
          </div>
        </div>
      </div>
    </div> -->
    <div
      *ngIf="appModuleDataPresent && showContent"
      class="d-flex m-3 tax-code-desc-section"
    >
      <div class="col-12">
        <div class="row d-flex">
          <div class="col-md-3 col-lg-3 col-sm-12 col-xs-12">
            <div
              class="programCode"
              [pTooltip]="
                this.mode == 'add'
                  ? 'Program Code is automatically generated, It may get changed in saving process.'
                  : ''
              "
            >
              <p style="position: relative">
                Program Code <span class="description red-star">*</span>
              </p>
              <input
                type="text"
                pInputText
                [(ngModel)]="programCode"
                disabled
              />
            </div>
          </div>
          <div class="col-md-3 col-lg-3 col-sm-12 col-xs-12">
            <div class="taxCode">
              <p style="position: relative">
                Program Type <span class="description red-star">*</span>
              </p>
              <p-dropdown
                name="application"
                inputId="application"
                [options]="programTypeOptions"
                [(ngModel)]="programType"
                placeholder="Select"
                optionValue="code"
                optionLabel="name"
                [disabled]="deactivated"
              >
                <ng-template let-options pTemplate="item">
                  <div class="truncate-text">
                    <div>{{ options.name }}</div>
                  </div>
                </ng-template></p-dropdown
              >
            </div>
          </div>
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <div class="row d-flex">
              <div class="col-md-7 col-lg-7 col-sm-12 col-xs-12 pr-0">
                <div class="taxDesc">
                  <p style="position: relative">
                    Program Description
                    <span class="description red-star">*</span>
                  </p>
                  <input
                    type="text"
                    pInputText
                    [(ngModel)]="programDescription"
                    maxlength="100"
                    placeholder="Max 100 characters"
                    [disabled]="deactivated"
                  />
                </div>
              </div>
              <div class="col-md-5 col-lg-5 col-sm-5 col-xs-5 pl-0 d-flex">
                <div class="uploadBtn">
                  <div class="file-upload-select" (click)="inpFile.click()">
                    <button
                      pButton
                      type="button"
                      icon="pi pi-upload"
                      class="operation-btns mr-2"
                      [disabled]="deactivated"
                    ></button>
                    <input
                      #inpFile
                      (change)="fileUploadChange($event)"
                      type="file"
                      name="file-upload-input"
                      id="file-upload-input"
                      accept=".svg, .png, .jpeg"
                    />
                  </div>
                </div>
                <div class="fileUploadLabel" *ngIf="getUploadedImgData?.length">
                  <span
                    [ngClass]="{ disabled: deactivated }"
                    (click)="!deactivated && showUploadedFilesModal()"
                    >Uploaded Images</span
                  >
                </div>
              </div>
              <!-- <div class="col-md-4 col-lg-4 col-sm-12 col-xs-12 pl-0">
                <div class="program-checkbox">
                  <p-checkbox
                    [(ngModel)]="Emailchecked"
                    binary="true"
                    inputId="binary"
                  ></p-checkbox>
                  <label style="padding-left: 10px; padding-right: 10px">
                    Send Email</label
                  >
                  <p-checkbox
                    [(ngModel)]="Msgchecked"
                    binary="true"
                    inputId="binary"
                  ></p-checkbox>
                  <label style="padding-left: 10px"> Send Message</label>
                </div>
              </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      *ngIf="appModuleDataPresent && showContent"
      class="d-flex m-3 tax-code-desc-section"
    >
      <div class="col-12">
        <div class="row d-flex">
          <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
            <div class="taxCode">
              <p style="color: var(--primary-color)">Promo Code Generation</p>
              <div class="row">
                <div class="col-md-3 col-lg-3 col-sm-3 col-xs-3">
                  <label for="" style="margin-right: 15px; position: relative"
                    >Promo Code Length
                    <span class="description red-star">*</span></label
                  >
                  <p-inputNumber
                    [(ngModel)]="promoCodeLength"
                    (onBlur)="onPromoCodeLength($event)"
                    [inputStyle]="{ width: '40px', padding: '0.5rem' }"
                    [disabled]="
                      (mode == 'edit' && !this.resetParam) || deactivated
                    "
                  >
                  </p-inputNumber>
                  <span
                    *ngIf="promoCodeLength && !validPromoCodeLength"
                    class="error-message"
                    >Length should be between 5 to 10.</span
                  >
                </div>
                <div class="col-md-5 col-lg-5 col-sm-5 col-xs-5">
                  <label for="" style="margin-right: 15px">Promo Code</label>
                  <input
                    type="text"
                    #userinput
                    pInputText
                    [(ngModel)]="promoCode"
                    [disabled]="true"
                    style="cursor: not-allowed; opacity: 1"
                  />
                  <button
                    pButton
                    type="button"
                    icon="pi pi-copy"
                    class="operation-btns mr-2 btnround"
                    (click)="copyInputMessage(userinput)"
                    [disabled]="deactivated"
                  ></button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <div
      *ngIf="appModuleDataPresent && showContent"
      class="d-flex m-3 tax-code-desc-section"
    >
      <div class="col-12">
        <div class="row d-flex">
          <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
            <div class="row">
              <div class="col-md-2 col-lg-2 col-sm-12 col-xs-12">
                <div class="taxCode">
                  <p style="position: relative">
                    From Date & Time <span class="description red-star">*</span>
                  </p>
                  <p-calendar
                    [(ngModel)]="criteriaTransactionDateFrom"
                    placeholder="DD/MM/YYYY  Hrs/Min"
                    dateFormat="dd/mm/yy"
                    [showTime]="true"
                    [showSeconds]="true"
                    [minDate]="today"
                    inputId="time"
                    appDateMask
                    (onSelect)="criteriaTransactionDateTo = null"
                  ></p-calendar>
                </div>
              </div>
              <div class="col-md-2 col-lg-2 col-sm-12 col-xs-12">
                <div class="taxCode">
                  <p style="position: relative">
                    To Date & Time <span class="description red-star">*</span>
                  </p>
                  <p-calendar
                    [(ngModel)]="criteriaTransactionDateTo"
                    [minDate]="criteriaTransactionDateFrom"
                    placeholder="DD/MM/YYYY  Hrs/Min"
                    dateFormat="dd/mm/yy"
                    [showTime]="true"
                    [showSeconds]="true"
                    inputId="time"
                    appDateMask
                  ></p-calendar>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> -->

    <app-set-criteria
      *ngIf="appModuleDataPresent && showContent"
      #setCriteriaSharedComponent
      [criteriaMasterData]="criteriaMasterData"
      [fieldDisplayData]="fieldDisplayData"
      [cmCriteriaDataDetails]="cmCriteriaDataDetails"
      [criteriaDataDetailsJson]="criteriaDataDetailsJson"
      [cmCriteriaSlabType]="cmCriteriaSlabType"
      [independantCriteriaArr]="independantCriteriaArr"
      [cmCriteriaMandatory]="cmCriteriaMandatory"
      [cmCriteriaDependency]="cmCriteriaDependency"
      [criteriaMapDdlOptions]="criteriaMapDdlOptions"
      [correspondentDdlOptions]="correspondentDdlOptions"
      [criteriaEqualsDdlOptions]="criteriaEqualsDdlOptions"
      [criteriaTemplatesDdlOptions]="criteriaTemplatesDdlOptions"
      [savingCriteriaTemplateError]="savingCriteriaTemplateError"
      [criteriaText]="criteriaText"
      [criteriaCodeText]="criteriaCodeText"
      [inactiveData]="inactiveData"
      [deactivated]="deactivated"
      (postDataCriteria)="applyCriteria($event)"
      (saveCriteriaAsTemplate)="saveCriteriaAsTemplate($event)"
      (getCorrespondentValues)="
        getCorrespondentValues(
          $event.fieldName,
          $event.displayName,
          $event.criteriaCodeText
        )
      "
    ></app-set-criteria>
  </div>
  <div class="details-page-card mt-2" *ngIf="applyCriteriaFormattedData.length">
    <div class="details-page-card-content mt-1">
      <div class="criteria-bar">
        <p class="setCriteria detail-page-section-heading">
          Applicable On
          <img
            height="15px"
            src="../assets/Icon-info.svg"
            alt=""
            pTooltip="On selected criteria below programs will be applied."
          />
        </p>
      </div>
      <div class="mt-1 addnewroute-table">
        <div class="ptable">
          <p-card class="p-col-12" *ngIf="!applyCriteriaResponse">
            {{ "noDataMsg" }}
          </p-card>
          <div class="appliedCriteriaDataTable">
            <p-table
              #dt
              [value]="applyCriteriaFormattedData"
              [rowHover]="true"
              [scrollable]="true"
              scrollHeight="315px"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th
                    *ngFor="let col of applyCriteriaDataTableColumns"
                    style="min-width: 120px"
                    alignFrozen="right"
                    pFrozenColumn
                    [frozen]="col['frozen']"
                  >
                    {{ col.header }}
                    <span *ngIf="isMandatoryCol(col.header)" class="red-star"
                      >*</span
                    >
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
                <tr>
                  <td
                    *ngFor="
                      let col of applyCriteriaDataTableColumns;
                      index as i
                    "
                    alignFrozen="right"
                    pFrozenColumn
                    [frozen]="col['frozen']"
                  >
                    <div
                      *ngIf="col['fieldType'] == 'dropdown'"
                      class="appliedCriteriaSelect"
                      [pTooltip]="
                        rowData['rewardsAs'] != 'Discount' && col['info']
                      "
                    >
                      <p-dropdown
                        [options]="rowData[col.field + 'Option']"
                        optionLabel="codeName"
                        appendTo="body"
                        [placeholder]="
                          rowData[col['field']] &&
                          rowData[col['field']] != 'null'
                            ? rowData[col['field']]
                            : 'Select'
                        "
                        (onChange)="
                          selectedColumn(col['field'], $event.value, rowIndex)
                        "
                        [disabled]="
                          rowData['linked'] == 'Y' ||
                          (col['field'] == 'discountAs' &&
                            rowData['rewardsAs'] != 'Discount') ||
                          rowData['isActive'] == 'N' ||
                          deactivated
                        "
                      >
                        <ng-template let-options pTemplate="item">
                          <div class="truncate-text">
                            <div>{{ options.codeName }}</div>
                          </div>
                        </ng-template></p-dropdown
                      >
                    </div>
                    <div
                      *ngIf="col['fieldType'] == 'input'"
                      [pTooltip]="col['info'] ? col['info'] : ''"
                      class="appliedCriteriaInput"
                    >
                      <p-inputNumber
                        #valInp
                        [min]="0"
                        [(ngModel)]="rowData[col['field']]"
                        [useGrouping]="false"
                        mode="decimal"
                        [maxFractionDigits]="1"
                        (onInput)="
                          changeValueInput(
                            applyCriteriaDataTableColumns[i - 1]['field'],
                            col['field'],
                            $event,
                            rowIndex,
                            valInp
                          )
                        "
                        [disabled]="
                          rowData['linked'] == 'Y' ||
                          deactivated ||
                          rowData['isActive'] == 'N'
                        "
                      ></p-inputNumber>
                    </div>
                    <div
                      *ngIf="col['fieldType'] == 'text'"
                      [pTooltip]="col['info'] ? col['info'] : ''"
                    >
                      <input
                        [(ngModel)]="rowData[col.field]"
                        type="text"
                        pInputText
                        [disabled]="true"
                      />
                    </div>
                    <div
                      *ngIf="col['fieldType'] == 'button'"
                      class="appliedCriteriaButton"
                    >
                      <ng-container
                        *ngFor="let btn of rowData[col['field']]?.split(',')"
                      >
                        <button
                          pButton
                          type="button"
                          [icon]="'pi pi-' + (btn == 'delete' ? 'trash' : btn)"
                          (click)="
                            checkOperation(btn, rowIndex, rowData, col['field'])
                          "
                          class="operation-btns mr-2"
                          [disabled]="deactivated"
                        ></button>
                      </ng-container>
                    </div>
                    <div
                      *ngIf="col.field == 'isActive'"
                      style="border: none; text-align: left"
                    >
                      <label class="switch" style="border: none">
                        <input
                          #statusInp
                          [value]="rowData[col['field']]"
                          type="checkbox"
                          (click)="confirmStatus($event, rowData)"
                          [checked]="
                            rowData[col['field']] == 'Y' ? true : false
                          "
                          [disabled]="rowData['linked'] == 'Y' || deactivated"
                        />
                        <span
                          class="slider round"
                          [ngClass]="{ disabled: deactivated }"
                        ></span>
                      </label>
                    </div>
                  </td>
                </tr>
              </ng-template>

              <ng-template pTemplate="emptymessage">
                <tr>
                  <td [attr.colspan]="applyCriteriaDataTableColumns.length">
                    No Data found.
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div
  class="NorecordFound"
  *ngIf="
    !showContent && appModuleDataPresent && !applyCriteriaFormattedData.length
  "
>
  <div class="row">
    <div class="col-12"><img src="assets/noRecordFound.svg" /></div>
  </div>
  <div class="row">
    <div class="col-12">
      <p>No Record Found.</p>
    </div>
  </div>
</div>

<div class="uploadedImgModal">
  <p-dialog
    [(visible)]="showFilesModal"
    [modal]="true"
    [style]="{ width: '40vw', left: '50px' }"
    (onHide)="closeDialog()"
  >
    <ng-template pTemplate="header">
      <div class="application-header">Uploaded Files</div>
    </ng-template>
    <p-table
      [value]="getUploadedImgData"
      class="criteria-view-table"
      [rowHover]="true"
      [style]="{ width: '100%' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th
            *ngFor="let col of uploadedfileDataCols"
            [style.text-align]="col['field'] == 'action' ? 'center' : ''"
          >
            {{ col.header }}
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-file let-rowIndex="rowIndex">
        <tr>
          <ng-container *ngFor="let col of uploadedfileDataCols; let i = index">
            <td *ngIf="col['field'] != 'action'">
              <input
                type="text"
                [placeholder]="file[col['field']]"
                [disabled]="true"
              />
            </td>
            <td
              *ngIf="col['field'] == 'action'"
              style="border: none; text-align: center; padding-left: 1rem"
            >
              <span class="image-text">
                <!-- <ng-container *ngFor="let icon of col['value'].split(',')"> -->
                <button
                  pButton
                  type="button"
                  [icon]="'pi pi-download'"
                  class="operation-btns mr-2"
                  (click)="fileOperation(file, rowIndex, 'download')"
                ></button>
                <button
                  *ngIf="file.id"
                  pButton
                  type="button"
                  [icon]="'pi pi-pencil'"
                  class="operation-btns mr-2"
                  (click)="fileOperation(file, rowIndex, 'edit')"
                ></button>
                <button
                  pButton
                  type="button"
                  [icon]="'pi pi-trash'"
                  class="operation-btns mr-2"
                  (click)="fileOperation(file, rowIndex, 'delete')"
                ></button>
                <!-- </ng-container> -->
              </span>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="uploadedfileDataCols.length">
            No files uploaded.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-dialog>
</div>

<p-confirmDialog
  key="linkedWarning"
  class="linked-confirm confirm-popup"
  #cd
  icon="pi pi-exclamation-triangle"
  [closable]="false"
>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      label="Ok"
      (click)="cd.accept()"
    ></button>
  </p-footer>
</p-confirmDialog>

<p-confirmDialog
  key="resetDataConfirmation"
  class="confirm-popup"
  #cd2
  icon="pi pi-exclamation-triangle"
  [closable]="false"
>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      label="Yes"
      (click)="cd2.accept()"
    ></button>

    <button
      type="button"
      pButton
      icon="pi pi-times"
      label="Cancel"
      (click)="cd2.reject()"
    ></button>
  </p-footer>
</p-confirmDialog>
<p-confirmDialog
  key="activeDeactiveStatus"
  class="status-confirm confirm-popup"
  #cd3
  [closable]="false"
>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      label="Yes"
      (click)="cd3.accept()"
    ></button>

    <button
      type="button"
      pButton
      icon="pi pi-times"
      label="No"
      (click)="cd3.reject()"
    ></button>
  </p-footer>
</p-confirmDialog>
<p-confirmDialog
  key="activeDeactiveStatusLoyalty"
  class="status-confirm confirm-popup"
  #cd4
  [closable]="false"
>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      label="Yes"
      (click)="cd4.accept()"
    ></button>

    <button
      type="button"
      pButton
      icon="pi pi-times"
      label="No"
      (click)="cd4.reject()"
    ></button>
  </p-footer>
</p-confirmDialog>
