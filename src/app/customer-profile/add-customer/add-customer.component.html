<div class="row visible-main-section">
  <div *ngIf="showForm" class="col-12">
    <p-tabView
      (onChange)="handleChange($event)"
      [(activeIndex)]="activeTabIndex"
    >
      <p-tabPanel
        header="Individual"
        [disabled]="mode == 'edit' && custType == 'COR'"
      >
        <form
          *ngIf="objectKeys(apiData).length"
          class="custom-form"
          [formGroup]="individualForm"
        >
          <ng-container *ngFor="let section of formSections">
            <p-panel
              [header]="section.formName"
              [toggleable]="true"
              [formGroup]="individualForm.controls[section.formName]"
              *ngIf="section.isVisible"
            >
              <div class="row">
                <div
                  *ngIf="section.formName == 'KYC Doc Upload'"
                  style="padding: 0; margin: 10px 0"
                >
                  <p-table
                    [value]="uploadedKycData"
                    *ngIf="uploadedKycData.length"
                  >
                    <ng-template pTemplate="header">
                      <tr>
                        <th>Document Type</th>
                        <th>ID Number</th>
                        <th>ID Issue Date</th>
                        <th>ID Expiry Date</th>
                        <th>ID Issue Authority</th>
                        <th>ID Issue Country</th>
                        <th>Front Side</th>
                        <th>Back Side</th>
                        <th>Doc History</th>
                      </tr>
                    </ng-template>
                    <ng-template
                      pTemplate="body"
                      let-product
                      let-rowIndex="rowIndex"
                    >
                      <tr>
                        <td
                          style="
                            cursor: pointer;
                            color: blue;
                            text-decoration: underline;
                          "
                          (click)="selectRowForEdit(product, rowIndex)"
                        >
                          {{ product.documentType }}
                        </td>
                        <td>{{ product.idNumber }}</td>
                        <td>{{ product.idIssueDate }}</td>
                        <td>{{ product.idExpiryDate }}</td>
                        <td>{{ product.idIssueAuthority }}</td>
                        <td>{{ product.idIssueCountry }}</td>
                        <td>{{ product.uploadFrontSideFileName }}</td>
                        <td>{{ product.uploadBackSideFileName }}</td>
                        <td>
                          <button
                            pButton
                            type="button"
                            icon="pi pi-eye"
                            class="operation-btns"
                            [disabled]="!product.uploadFrontSide"
                            (click)="
                              downloadDoc('kyc', product.uploadFrontSide)
                            "
                          ></button>
                          <button
                            pButton
                            type="button"
                            icon="pi pi-download"
                            class="operation-btns"
                            [disabled]="!product.uploadFrontSide"
                            (click)="viewDoc('kyc', product.uploadFrontSide)"
                          ></button>
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
                <div
                  *ngIf="section.formName == 'Representative Details'"
                  style="padding: 0; margin: 10px 0"
                >
                  <p-table
                    [value]="uploadedRepresentativeData"
                    *ngIf="uploadedRepresentativeData.length"
                  >
                    <ng-template pTemplate="header">
                      <tr>
                        <th>First Name</th>
                        <th>Middle Name</th>
                        <th>Last Name</th>
                        <th>Gender</th>
                        <th>Date of Birth</th>
                        <th>Country of Birth</th>
                        <th>Nationality</th>
                        <th>Relationship</th>
                        <th>Document Type</th>
                        <th>ID Number</th>
                        <th>ID Issue Date</th>
                        <th>ID Expiry Date</th>
                        <th>ID Issue Authority</th>
                        <th>ID Issue Country</th>
                        <th>Visa Expiry Date</th>
                        <th>Authorization letter expiry date</th>
                        <th>Maximum allowed amount</th>
                        <th>ID copy upload</th>
                        <th>Authorization letter upload</th>
                        <th>Other Document upload</th>
                        <!-- <th>Doc History</th> -->
                      </tr>
                    </ng-template>
                    <ng-template
                      pTemplate="body"
                      let-product
                      let-rowIndex="rowIndex"
                    >
                      <tr>
                        <td
                          style="
                            cursor: pointer;
                            color: blue;
                            text-decoration: underline;
                          "
                          (click)="
                            selectRowForEditRepresentative(product, rowIndex)
                          "
                        >
                          {{ product.representativeFirstName }}
                        </td>
                        <td>{{ product.representativeMiddelName }}</td>
                        <td>{{ product.representativeLastName }}</td>
                        <td>{{ product.representativeGender }}</td>
                        <td>{{ product.representativeDateOfBirth }}</td>
                        <td>{{ product.representativeCountryOfBirth }}</td>
                        <td>{{ product.representativeNationality }}</td>
                        <td>{{ product.representativeRelationship }}</td>
                        <td>{{ product.representativeDocumentType }}</td>
                        <td>{{ product.representativeIdNumber }}</td>
                        <td>{{ product.representativeIdIssueDate }}</td>
                        <td>{{ product.representativeIdExpiryDate }}</td>
                        <td>{{ product.representativeIdIssueAuthority }}</td>
                        <td>{{ product.representativeIdIssueCountry }}</td>
                        <td>{{ product.representativeVisaExpireDate }}</td>
                        <td>
                          {{
                            product.representativeAuthorizationLetterExpireDate
                          }}
                        </td>
                        <td>
                          {{ product.representativeMaximumAllowedAmount }}
                        </td>
                        <td>
                          {{ product.representativeIdCopyUploadFileName }}
                        </td>
                        <td>
                          {{
                            product.representativeAuthorizationLetterFileName
                          }}
                        </td>
                        <td>{{ product.otherDocumentUploadFileName }}</td>
                        <!-- <td>
                  <button
                    pButton
                    type="button"
                    icon="pi pi-eye"
                    class="operation-btns"
                    [disabled]="!product.representativeIdCopyUploadName"
                    (click)="
                      downloadDoc(
                        'repres',
                        product.representativeIdCopyUploadName
                      )
                    "
                  ></button>
                  <button
                    pButton
                    type="button"
                    icon="pi pi-download"
                    class="operation-btns"
                    [disabled]="!product.representativeIdCopyUploadName"
                    (click)="
                      viewDoc('repres', product.representativeIdCopyUploadName)
                    "
                  ></button>
                </td> -->
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
                <ng-container *ngFor="let field of section.fields">
                  <div
                    *ngIf="field.visible && field.fieldType != 'currency'"
                    [ngClass]="{
                      'col-2': true,
                      checkbox: field.fieldType == 'checkbox'
                    }"
                  >
                    <label>{{ field.fieldLabel }}</label
                    ><span *ngIf="field.required" class="required">*</span>
                    <ng-container [ngSwitch]="field.fieldType">
                      <input
                        *ngSwitchCase="'text'"
                        type="text"
                        class="block"
                        pInputText
                        [formControlName]="field.name"
                      />
                      <input
                        *ngSwitchCase="'number'"
                        type="text"
                        class="block"
                        pInputText
                        [formControlName]="field.name"
                      />

                      <p-calendar
                        *ngSwitchCase="'date'"
                        class="block"
                        placeholder="DD/MM/YYYY"
                        dateFormat="dd/mm/yy"
                        [showIcon]="true"
                        [formControlName]="field.name"
                        [minDate]="field.minDate"
                        [maxDate]="field.maxDate"
                        [defaultDate]="field.defaultDate"
                        [readonlyInput]="true"
                        [appendTo]="'body'"
                      ></p-calendar>
                      <p-checkbox
                        *ngSwitchCase="'checkbox'"
                        [formControlName]="field.name"
                        [binary]="true"
                        inputId="binary"
                        (onChange)="sameAddress($event, field.name)"
                      ></p-checkbox>
                      <p-dropdown
                        *ngSwitchCase="'select'"
                        class="block"
                        [options]="masterData[field.apiKey]"
                        [formControlName]="field.name"
                        placeholder="&nbsp;"
                        optionLabel="codeName"
                      ></p-dropdown>
                      <p-dropdown
                        *ngSwitchCase="'smart-search'"
                        class="block"
                        [formControlName]="field.name"
                        [options]="masterData[field.apiKey]"
                        optionLabel="codeName"
                        [filter]="true"
                        filterBy="codeName"
                        placeholder="Type to search"
                      >
                        <ng-template pTemplate="selectedItem">
                          <div
                            class="country-item country-item-value"
                            *ngIf="field"
                          >
                            <div>
                              {{
                                individualForm.controls[section.formName][
                                  "controls"
                                ][field.name].value.codeName
                              }}
                            </div>
                          </div>
                        </ng-template>
                        <ng-template let-country pTemplate="item">
                          <div class="country-item">
                            <div>{{ country.codeName }}</div>
                          </div>
                        </ng-template>
                      </p-dropdown>
                      <div
                        *ngSwitchCase="'file'"
                        class="file-upload"
                        [pTooltip]="
                          individualForm
                            .get(section.formName)
                            .get(
                              section.formName == 'Representative Details'
                                ? 'representativeIdNumber'
                                : 'idNumber'
                            )?.value == '' ||
                          individualForm
                            .get(section.formName)
                            .get(
                              section.formName == 'Representative Details'
                                ? 'representativeIdNumber'
                                : 'idNumber'
                            )?.value == null
                            ? 'Enter Id Number first'
                            : ''
                        "
                      >
                        <div
                          class="file-upload-select"
                          [style.pointerEvents]="
                            individualForm
                              .get(section.formName)
                              .get(
                                section.formName == 'Representative Details'
                                  ? 'representativeIdNumber'
                                  : 'idNumber'
                              )?.value == '' ||
                            individualForm
                              .get(section.formName)
                              .get(
                                section.formName == 'Representative Details'
                                  ? 'representativeIdNumber'
                                  : 'idNumber'
                              )?.value == null
                              ? 'none'
                              : ''
                          "
                          (click)="inpFile.click()"
                        >
                          <div class="file-select-name">
                            <input type="text" [formControlName]="field.name" />
                          </div>
                          <div class="file-select-button">
                            <i class="pi pi-upload"></i>
                          </div>
                          <input
                            #inpFile
                            (change)="
                              fileUploadChange(
                                $event,
                                section.formName,
                                field.name,
                                individualForm
                                  .get(section.formName)
                                  .get(
                                    section.formName == 'Representative Details'
                                      ? 'representativeIdNumber'
                                      : 'idNumber'
                                  )?.value
                              )
                            "
                            type="file"
                            name="file-upload-input"
                            id="file-upload-input"
                            [disabled]="
                              individualForm
                                .get(section.formName)
                                .get(
                                  section.formName == 'Representative Details'
                                    ? 'representativeIdNumber'
                                    : 'idNumber'
                                )?.value == '' ||
                              individualForm
                                .get(section.formName)
                                .get(
                                  section.formName == 'Representative Details'
                                    ? 'representativeIdNumber'
                                    : 'idNumber'
                                )?.value == null ||
                              !field.enable
                            "
                          />
                        </div>
                      </div>
                      <select
                        *ngSwitchCase="'multiselect'"
                        multiple
                        [formControlName]="field.name"
                      >
                        <option
                          *ngFor="let option of field.options"
                          [value]="option.value"
                        >
                          {{ option.label }}
                        </option>
                      </select>
                    </ng-container>
                    <small
                      *ngIf="
                        submitted &&
                        individualForm.controls[section.formName]['controls'][
                          field.name
                        ].errors?.required
                      "
                      class="p-error block"
                      >{{ field.fieldLabel }} is required.</small
                    >
                    <small
                      *ngIf="
                        submitted &&
                        individualForm.controls[section.formName]['controls'][
                          field.name
                        ].errors?.minlength
                      "
                      class="p-error block"
                      >{{ field.fieldLabel }} must be
                      {{ field.minLength }} characters long.</small
                    >
                    <small
                      *ngIf="
                        submitted &&
                        individualForm.controls[section.formName]['controls'][
                          field.name
                        ].errors?.pattern
                      "
                      class="p-error block"
                      >Improper {{ field.fieldLabel }} format.</small
                    >
                    <small
                      *ngIf="
                        submitted &&
                        individualForm.controls[section.formName]['controls'][
                          field.name
                        ].errors?.maxlength
                      "
                      class="p-error block"
                      >{{ field.fieldLabel }} must not exceed
                      {{ field.maxLength }} characters.</small
                    >
                  </div>
                </ng-container>
                <div *ngIf="section.formName == 'KYC Doc Upload'">
                  <button
                    #addCriteriaBtn
                    pButton
                    pRipple
                    style="position: static; left: 645px; font-size: 1.5rem"
                    type="button"
                    label="+"
                    class="p-button-primary"
                    (click)="addKyc()"
                    [disabled]="
                      individualForm.get('KYC Doc Upload').get('idNumber')
                        .value == '' ||
                      individualForm.get('KYC Doc Upload').get('idNumber')
                        .value == null ||
                      individualForm.get('KYC Doc Upload').get('documentType')
                        .value == '' ||
                      individualForm.get('KYC Doc Upload').get('documentType')
                        .value == null
                    "
                  ></button>
                </div>
                <div *ngIf="section.formName == 'Representative Details'">
                  <button
                    #addCriteriaBtn
                    pButton
                    pRipple
                    style="position: static; left: 645px; font-size: 1.5rem"
                    type="button"
                    label="+"
                    class="p-button-primary"
                    (click)="addRepresentative()"
                    [disabled]="
                      individualForm
                        .get('Representative Details')
                        .get('representativeIdNumber').value == '' ||
                      individualForm
                        .get('Representative Details')
                        .get('representativeIdNumber').value == null ||
                      individualForm
                        .get('Representative Details')
                        .get('representativeDocumentType').value == '' ||
                      individualForm
                        .get('Representative Details')
                        .get('representativeDocumentType').value == null
                    "
                  ></button>
                </div>
              </div>
            </p-panel>
            <p-panel
              *ngIf="!section.isVisible"
              [header]="section.formName"
              class="no-visible"
            >
              No Visible fields available.
            </p-panel>
          </ng-container>
          <div class="form-group btn-grp buttons-section">
            <button
              pButton
              pRipple
              type="button"
              label="Save"
              class="p-button-raised"
              (click)="onSubmit()"
            ></button>
            <button
              pButton
              pRipple
              type="button"
              label="Reset"
              class="p-button-warning"
              (click)="onReset()"
            ></button>
          </div>
        </form>
      </p-tabPanel>
      <p-tabPanel
        header="Corporate"
        [disabled]="mode == 'edit' && custType == 'IND'"
      >
        <ng-template pTemplate="content">
          <app-corporate [activeIndex]="activeTabIndex"></app-corporate>
        </ng-template>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>
