<div class="visible-main-section">
  <div class="pagetitle detail-page">
    <nav>
      <ol class="breadcrumb"></ol>
    </nav>
  </div>
  <div class="details-page-card">
    <div class="d-flex mx-3" style="justify-content: space-between">
      <p class="description-text">
        <!-- <img height="35px" src="../assets/description.svg" alt="" /> -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="41"
          height="35"
          viewBox="0 0 41 41"
        >
          <g
            id="Group_2248"
            data-name="Group 2248"
            transform="translate(-341 -138)"
          >
            <circle
              id="Ellipse_130"
              data-name="Ellipse 130"
              cx="20.5"
              cy="20.5"
              r="20.5"
              transform="translate(341 138)"
              [attr.fill]="primaryColor"
            />
            <path
              id="_52_Note_Basic_Description"
              data-name="52  Note, Basic, Description"
              d="M17.054,9.537H9.52a.753.753,0,0,1-.753-.753V5.016a.753.753,0,0,1,.753-.753h.851a3.014,3.014,0,0,1,5.831,0h.851a.753.753,0,0,1,.753.753V8.783A.753.753,0,0,1,17.054,9.537ZM10.274,8.03H16.3V5.77h-.753a.753.753,0,0,1-.753-.753,1.507,1.507,0,0,0-3.014,0,.753.753,0,0,1-.753.753h-.753Zm11.3,12.808V7.277a2.26,2.26,0,0,0-2.26-2.26h-.753V6.523h.753a.753.753,0,0,1,.753.753V20.837a.753.753,0,0,1-.753.753H7.26a.753.753,0,0,1-.753-.753V7.277a.753.753,0,0,1,.753-.753h.753V5.016H7.26A2.26,2.26,0,0,0,5,7.277V20.837A2.26,2.26,0,0,0,7.26,23.1H19.314A2.26,2.26,0,0,0,21.574,20.837ZM17.808,11.8H8.767V13.3h9.041Zm0,3.014H8.767v1.507h9.041Zm0,3.014H8.767v1.507h9.041Z"
              transform="translate(348.213 145.945)"
              fill="#fff"
            />
          </g>
        </svg>
        Based on the critetria selected banks will be routed to preferred
        routing bank.
      </p>
      <div class="buttons-section">
        <button
          pButton
          pRipple
          type="button"
          [disabled]="!bankRoutesData || !bankRoutesData.length"
          label="Save"
          class="p-button-raised"
          (click)="saveAddNewRoute('save')"
        ></button>
        <button
          pButton
          pRipple
          type="button"
          [disabled]="!bankRoutesData.length"
          label="Save & Add New"
          class="p-button-raised"
          (click)="saveAddNewRoute('saveAndAddNew')"
        ></button>
        <button
          pButton
          pRipple
          type="button"
          [disabled]="!bankRoutesData.length"
          label="Reset"
          class="p-button-warning"
          (click)="reset()"
        ></button>
      </div>
    </div>
    <div
      class="details-page-card-content criteria-main-section mt-2"
      style="position: relative"
    >
      <div class="criteria-bar">
        <p class="setCriteria detail-page-section-heading">
          Set Criteria
          <img
            height="15px"
            src="../assets/Icon-info.svg"
            alt=""
            pTooltip="Based on the selected criteria banks will be routed."
          />
        </p>
        <div class="openCriteria">
          <p class="clickcriteria">
            <a (click)="openClickForSave()"
              >Click to save this Criteria as a template</a
            >
          </p>
        </div>
      </div>
      <p-dialog
        [(visible)]="clickforsave"
        [appendTo]="'body'"
        [modal]="true"
        [style]="{ width: '30vw' }"
        class="saveTemplateModal"
      >
        <ng-template
          pTemplate="header"
          style="border-top-right-radius: 10px !important"
        >
          Save Template
        </ng-template>
        <p>Name</p>
        <input type="text" class="form-control" [(ngModel)]="criteriaName" />
        <ng-template pTemplate="footer" style="text-align: center">
          <button
            pButton
            pRipple
            type="button"
            label="Save"
            (click)="saveCriteriaAsTemplate()"
            class="p-button-raised"
          ></button>
        </ng-template>
      </p-dialog>

      <div class="dropdowns-select-container mb-3">
        <div [formGroup]="selectCriteriaForm" class="left-dropdowns">
          <p-dropdown
            class="mr-3"
            [options]="criteriaMapDdlOptions"
            optionLabel="name"
            placeholder="Select Criteria"
            (onChange)="onCriteriaSelect( $event.value)"
            formControlName="criteria"
            ></p-dropdown>
            <!-- (onChange)="onChange('criteria', $event.value)" -->

          <p-dropdown
            class="mr-3"
            [options]="criteriaEqualsDdlOptions"
            optionLabel="name"
            placeholder="Select Operator"
            (onChange)="onChange('condition', $event.value)"
            formControlName="operation"
          ></p-dropdown>

          <p-dropdown
            *ngIf="!hideValuesDropdown"
            class="mr-1"
            [options]="correspondentDdlOptions"
            optionLabel="name"
            placeholder="Value"
            (onChange)="onChange('val', $event.value)"
            formControlName="value"
          ></p-dropdown>
          <button
            #addCriteriaBtn
            pButton
            pRipple
            style="position: absolute; left: 525px; font-size: 1.5rem"
            type="button"
            label="+"
            class="p-button-primary"
            [disabled]="!selectCriteriaForm.valid"
            (click)="addCriteriaMap()"
          ></button>
        </div>
        <div class="right-select">
          <p-dropdown
            class="templates-dropdown"
            [options]="criteriaTemplatesDdlOptions"
            optionLabel="name"
            [appendTo]="'body'"
            placeholder="{{
              criteriaTemplatesDdlOptions.length
                ? 'Select Template'
                : 'No saved templates'
            }}"
            [disabled]="!criteriaTemplatesDdlOptions.length"
            (onChange)="selectCriteriaTemplate($event.value)"
            [(ngModel)]="selectedTemplate"
          ></p-dropdown>
        </div>
      </div>
      <div style="padding: 0 1rem; display: flex; flex-wrap: wrap">
        <span
          *ngFor="let criteria of criteriaText; let i = index"
          (click)="
            savedLcySlabs &&
              criteria == 'LCY Amount = Slab' &&
              showTransCriteriaModal()
          "
          class="criteria-span"
          [ngStyle]="{
            backgroundColor: criteria.includes('!=')
              ? 'rgb(248 253 235)'
              : 'var(--surface-ground)'
          }"
        >
          {{ criteria == "LCY Amount = Slab" ? "" : criteria
          }}<a
            style="cursor: pointer"
            *ngIf="criteria == 'LCY Amount = Slab'"
            >{{ criteria }}</a
          >
          <span
            role="button"
            style="padding: 0px 0px 0px 15px; margin-bottom: 10px"
            (click)="ondeletecriteria(i, criteria)"
          >
            <svg
              style="margin-bottom: 4px"
              xmlns="http://www.w3.org/2000/svg"
              width="12.6"
              height="12.6"
              fill="#dc3545"
              class="bi bi-x-circle"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
              />
              <path
                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
              />
            </svg>
          </span>
        </span>
        <div class="applycriteriabtn">
          <button
            pButton
            pRipple
            type="button"
            label="Apply Criteria"
            class="p-button-raised"
            [disabled]="!criteriaText?.length"
            (click)="applyCriteria()"
          ></button>
        </div>
      </div>
    </div>
  </div>
  <div class="details-page-card mt-2">
    <div class="details-page-card-content mt-1">
      <div class="criteria-bar">
        <p class="setCriteria detail-page-section-heading">
          Applicable Routes
          <img
            height="15px"
            src="../assets/Icon-info.svg"
            alt=""
            pTooltip="On selected criteria routes below routes will be applied."
          />
        </p>
      </div>
      <div class="mt-1 addnewroute-table">
        <p-table
          #table
          [value]="bankRoutesData"
          editMode="row"
          scrollHeight="700px"
          [rowHover]="true"
        >
          <ng-template pTemplate="header">
            <tr>
              <ng-container *ngFor="let col of bankRoutesColumns">
                <th *ngIf="col.visible">
                  {{ col.header }}
                </th>
              </ng-container>
            </tr>
          </ng-template>
          <ng-template
            pTemplate="body"
            let-row
            let-col="bankRoutesColumns"
            let-rowIndex="rowIndex"
          >
            <tr>
              <ng-container *ngFor="let col of bankRoutesColumns">
                <td *ngIf="col.visible" pEditable="true">
                  <span
                    *ngIf="
                      col.field != 'routeToBankName' &&
                      col.field != 'routeToServiceCategory' &&
                      col.field != 'routeToServiceType'
                    "
                    >{{ row[col.field] }}</span
                  >
                  <select
                    (change)="selectedColumn('routeToBankName', row, rowIndex)"
                    class="form-select"
                    *ngIf="col.field == 'routeToBankName'"
                    [(ngModel)]="row[col.field]"
                    [value]="row[col.field]"
                  >
                    <option value="" selected>Select</option>
                    <option *ngFor="let name of row.routeToBankNameOption">
                      {{ name.codeName }}
                    </option>
                  </select>
                  <select
                    id="dropdownid"
                    (change)="
                      selectedColumn('routeToServiceCategory', row, rowIndex)
                    "
                    class="form-select"
                    *ngIf="col.field == 'routeToServiceCategory'"
                    [(ngModel)]="row[col.field]"
                    [value]="row[col.field]"
                  >
                    <option value="" selected>Select</option>
                    <option
                      *ngFor="let name of row.routeToServiceCategoryOption"
                    >
                      {{ name.codeName }}
                    </option>
                  </select>
                  <select
                    (change)="
                      selectedColumn('routeToServiceType', row, rowIndex)
                    "
                    class="form-select"
                    *ngIf="col.field == 'routeToServiceType'"
                    [(ngModel)]="row[col.field]"
                    [value]="row[col.field]"
                  >
                    <option value="" selected>Select</option>
                    <option *ngFor="let name of row.routeToServiceTypeOption">
                      {{ name.codeName }}
                    </option>
                  </select>
                </td>
              </ng-container>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>
