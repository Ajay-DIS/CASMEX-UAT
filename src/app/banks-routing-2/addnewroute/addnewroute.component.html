<div class="visible-main-section">
  <div class="details-page-card">
    <div class="d-flex mx-3" style="justify-content: space-between">
      <p class="description-text">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="41"
          height="35"
          viewBox="0 0 41 41"
        >
          <g
            id="Group_2248"
            data-name="Group 2248"
            transform="translate(-341 -138)"
          >
            <circle
              id="Ellipse_130"
              data-name="Ellipse 130"
              cx="20.5"
              cy="20.5"
              r="20.5"
              transform="translate(341 138)"
              [attr.fill]="primaryColor"
            />
            <path
              id="_52_Note_Basic_Description"
              data-name="52  Note, Basic, Description"
              d="M17.054,9.537H9.52a.753.753,0,0,1-.753-.753V5.016a.753.753,0,0,1,.753-.753h.851a3.014,3.014,0,0,1,5.831,0h.851a.753.753,0,0,1,.753.753V8.783A.753.753,0,0,1,17.054,9.537ZM10.274,8.03H16.3V5.77h-.753a.753.753,0,0,1-.753-.753,1.507,1.507,0,0,0-3.014,0,.753.753,0,0,1-.753.753h-.753Zm11.3,12.808V7.277a2.26,2.26,0,0,0-2.26-2.26h-.753V6.523h.753a.753.753,0,0,1,.753.753V20.837a.753.753,0,0,1-.753.753H7.26a.753.753,0,0,1-.753-.753V7.277a.753.753,0,0,1,.753-.753h.753V5.016H7.26A2.26,2.26,0,0,0,5,7.277V20.837A2.26,2.26,0,0,0,7.26,23.1H19.314A2.26,2.26,0,0,0,21.574,20.837ZM17.808,11.8H8.767V13.3h9.041Zm0,3.014H8.767v1.507h9.041Zm0,3.014H8.767v1.507h9.041Z"
              transform="translate(348.213 145.945)"
              fill="#fff"
            />
          </g>
        </svg>
        Based on the critetria selected banks will be routed to preferred
        routing bank.
      </p>
      <div class="buttons-section">
        <button
          pButton
          pRipple
          type="button"
          [disabled]="!appliedCriteriaData || !appliedCriteriaData.length"
          label="Save"
          class="p-button-raised"
          (click)="saveAddNewRoute('save')"
        ></button>
        <button
          pButton
          pRipple
          type="button"
          [disabled]="!appliedCriteriaData.length"
          label="Save & Add New"
          class="p-button-raised"
          (click)="saveAddNewRoute('saveAndAddNew')"
        ></button>
        <button
          pButton
          pRipple
          type="button"
          [disabled]="!appliedCriteriaData.length"
          label="Reset"
          class="p-button-warning"
          (click)="reset()"
        ></button>
      </div>
    </div>
    <div
      class="details-page-card-content criteria-main-section mt-2"
      style="position: relative"
    >
      <div class="criteria-bar">
        <p class="setCriteria detail-page-section-heading">
          Set Criteria
          <img
            height="15px"
            src="../assets/Icon-info.svg"
            alt=""
            pTooltip="Based on the selected criteria banks will be routed."
          />
        </p>
        <div class="openCriteria">
          <p class="clickcriteria">
            <a (click)="saveCriteriaTemplateLink()"
              >Click to save this Criteria as a template</a
            >
          </p>
        </div>
      </div>
      <p-dialog
        [(visible)]="saveTemplateDialogOpen"
        [contentStyle]="{ overflow: 'visible' }"
        [modal]="true"
        [style]="{ width: '615px', height: '230px' }"
        [class]="{ saveTemplateModal: true }"
        (onHide)="closeDialog()"
        [draggable]="false"
        [resizable]="false"
      >
        <ng-template
          pTemplate="header"
          style="border-top-right-radius: 10px !important"
        >
          Save Template
        </ng-template>
        <p class="mb-2" style="font-weight: 500">Name</p>
        <input
          class="w-100"
          type="text"
          pInputText
          [(ngModel)]="criteriaName"
        />
        <div
          *ngIf="savingCriteriaTemplateError"
          class="saving-criteria-template-error"
        >
          <i class="red-dot pi pi-circle-fill"></i>
          {{ savingCriteriaTemplateError }}
        </div>
        <ng-template pTemplate="footer">
          <div style="text-align: center">
            <button
              pButton
              pRipple
              type="button"
              label="Save"
              (click)="saveCriteriaAsTemplate()"
              class="p-button-raised"
              [style]="{ width: '92px' }"
            ></button>
          </div>
        </ng-template>
      </p-dialog>

      <div class="dropdowns-select-container mb-3">
        <div [formGroup]="selectCriteriaForm" class="left-dropdowns">
          <!-- <p-dropdown
            class="mr-3"
            [options]="criteriaMapDdlOptions"
            optionLabel="name"
            placeholder="Select Criteria"
            (onChange)="onCriteriaSelect($event.value)"
            formControlName="criteria"
          >
            <ng-template let-criteria pTemplate="item">
              <div [pTooltip]="getTooltip(criteria)">
                {{ criteria.name }}
              </div>
            </ng-template>
          </p-dropdown> -->

          <p-treeSelect
            class="mr-3"
            scrollHeight="300px"
            [options]="criteriaMapDdlOptions"
            placeholder="Select Criteria"
            formControlName="criteria"
            (onNodeSelect)="onCriteriaSelect($event.node)"
          >
            <ng-template let-criteria pTemplate="default">
              <div
                [pTooltip]="
                  getTooltip(
                    criteria['isMandatory'],
                    criteria['isDependent'],
                    criteria['dependencyList']
                  )
                "
              >
                {{ criteria.label }}
              </div>
            </ng-template>
          </p-treeSelect>

          <p-dropdown
            class="mr-3"
            [options]="criteriaEqualsDdlOptions"
            optionLabel="name"
            placeholder="Select Operator"
            (onChange)="onChange('condition', $event.value)"
            formControlName="operation"
          ></p-dropdown>

          <p-dropdown
            *ngIf="!hideValuesDropdown"
            class="mr-1"
            [options]="correspondentDdlOptions"
            optionLabel="name"
            placeholder="Value"
            (onChange)="onChange('val', $event.value)"
            formControlName="value"
          ></p-dropdown>

          <p-inputNumber
            class="value-input"
            *ngIf="hideValuesDropdown && showValueInput"
            placeholder="Value"
            pInputNumber
            formControlName="value"
            [useGrouping]="false"
            [min]="0"
            maxlength="10"
            maxValue="9999999999"
            (onInput)="changeValueInput($event)"
          >
          </p-inputNumber>

          <button
            #addCriteriaBtn
            pButton
            pRipple
            style="position: absolute; left: 645px; font-size: 1.5rem"
            type="button"
            label="+"
            class="p-button-primary"
            [disabled]="!selectCriteriaForm.valid"
            (click)="addCriteriaMap()"
          ></button>
        </div>
        <div class="right-select">
          <p-dropdown
            #templatesDropdown
            class="templates-dropdown"
            [options]="criteriaTemplatesDdlOptions"
            optionLabel="name"
            [appendTo]="'body'"
            [placeholder]="
              criteriaTemplatesDdlOptions.length
                ? 'Select Template'
                : 'No saved templates'
            "
            [disabled]="!criteriaTemplatesDdlOptions.length"
            (onChange)="selectCriteriaTemplate($event.value)"
            [(ngModel)]="selectedTemplate"
          ></p-dropdown>
        </div>
      </div>
      <div style="padding: 0 1rem; display: flex; flex-wrap: wrap">
        <span
          *ngFor="let criteria of criteriaText; let i = index"
          (click)="
            savedSlabs &&
              criteria == cmCriteriaSlabType[0] + ' = Slab' &&
              showTransCriteriaModal()
          "
          class="criteria-span"
          [ngStyle]="{
            backgroundColor: criteria.includes('!=')
              ? 'rgb(248 253 235)'
              : 'var(--surface-ground)'
          }"
        >
          {{ criteria == cmCriteriaSlabType[0] + " = Slab" ? "" : criteria
          }}<a
            style="cursor: pointer"
            *ngIf="criteria == cmCriteriaSlabType[0] + ' = Slab'"
            >{{ criteria }}</a
          >
          <span
            role="button"
            style="padding: 0px 0px 0px 15px; margin-bottom: 10px"
            (click)="ondeletecriteria(i, criteria)"
          >
            <svg
              style="margin-bottom: 4px"
              xmlns="http://www.w3.org/2000/svg"
              width="12.6"
              height="12.6"
              fill="#dc3545"
              class="bi bi-x-circle"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
              />
              <path
                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
              />
            </svg>
          </span>
        </span>
        <div class="applycriteriabtn">
          <button
            pButton
            pRipple
            type="button"
            label="Apply Criteria"
            class="p-button-raised"
            [disabled]="!criteriaText?.length"
            (click)="applyCriteria()"
          ></button>
        </div>
      </div>
    </div>
  </div>
  <div class="details-page-card mt-2" *ngIf="appliedCriteriaData.length">
    <div class="details-page-card-content mt-1">
      <div class="criteria-bar">
        <p class="setCriteria detail-page-section-heading">
          Applicable Routes
          <img
            height="15px"
            src="../assets/Icon-info.svg"
            alt=""
            pTooltip="On selected criteria routes below routes will be applied."
          />
        </p>
      </div>
      <div class="mt-1 addnewroute-table">
        <div class="ptable">
          <p-card class="p-col-12" *ngIf="!appliedCriteriaData">
            {{ "noDataMsg" }}
          </p-card>
          <div class="appliedCriteriaDataTable">
            <!-- [frozenColumns]="appliedCriteriaDataFrozenCols" -->
            <p-table
              #dt
              [columns]="appliedCriteriaDataCols"
              [value]="appliedCriteriaData"
              [rows]="10"
              columnResizeMode="expand"
              [rowHover]="true"
              [scrollable]="true"
            >
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <ng-container *ngFor="let col of columns; let c = index">
                    <th
                      [pSortableColumn]="col?.field"
                      [style.maxWidth]="col?.maxWidth"
                      [style.minWidth]="col?.minWidth"
                      alignFrozen="right"
                      pFrozenColumn
                      [frozen]="col['isSelect']"
                      style="right: 121px !important"
                    >
                      {{ col.header.split("*")[0] }}
                      <span *ngIf="isMandatoryCol(col.header)" class="red-star"
                        >*</span
                      >
                    </th>
                  </ng-container>
                </tr>
              </ng-template>
              <ng-template
                pTemplate="body"
                let-rowData
                let-columns="columns"
                let-rowIndex="rowIndex"
              >
                <tr>
                  <ng-container *ngFor="let col of columns; let i = index">
                    <td
                      alignFrozen="right"
                      pFrozenColumn
                      [frozen]="col['isSelect']"
                    >
                      <div
                        *ngIf="col['isString']"
                        style="display: inline-block"
                      >
                        {{ rowData[col["field"]] }}
                      </div>
                      <div
                        *ngIf="col['isSelect']"
                        class="appliedCriteriaSelect"
                        style="display: inline-block; width: 90%"
                      >
                        <p-dropdown
                          [options]="rowData[col['field']]"
                          optionLabel="codeName"
                          appendTo="body"
                          [placeholder]="
                            rowData[col['field'] + 'Option']
                              ? rowData[col['field'] + 'Option']
                              : 'Select'
                          "
                          (onChange)="
                            selectedColumn(col['field'], $event.value, rowIndex)
                          "
                        ></p-dropdown>
                      </div>
                    </td>
                  </ng-container>
                </tr>
              </ng-template>

              <ng-template pTemplate="emptymessage">
                <tr>
                  <td [attr.colspan]="cols.length">No Data found.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<p-confirmDialog
  key="criteriaDeleteConfirm"
  class="criteria-delete-confirm"
  #cd
  icon="pi pi-exclamation-triangle"
  appendTo="body"
  [closable]="false"
>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-times"
      label="Cancel"
      (click)="cd.reject()"
    ></button>

    <button
      type="button"
      pButton
      icon="pi pi-check"
      label="Delete"
      (click)="cd.accept()"
    ></button>
  </p-footer>
</p-confirmDialog>
